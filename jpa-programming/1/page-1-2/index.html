<!doctype html>
<html lang="ko-kr">
  <head>
    <title>[자바 ORM 표준 JPA 프로그래밍] 2장 JPA 시작 // @stoptheworld99</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.57.0-DEV" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="riley" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.59023e5fd38d6ecb0e1dfbb295077c3c67e00e3b9eb3feaf34b5a5e6b332897a.css" />
    <link rel="stylesheet" href="/css/syntax.css">
    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[자바 ORM 표준 JPA 프로그래밍] 2장 JPA 시작"/>
<meta name="twitter:description" content="김영한님의 책 자바 ORM 표준 JPA 프로그래밍 학습 내용 정리
2.2 H2 데이터베이스 설치 H2DB 는 자바 기반의 오픈소스 관계형 데이터 베이스이다. 별도의 설치과정이 필요하지 않고 용량도 1.7M 로 가볍다. SQL 문법은 다른 DBMS 와 마찬가지로 표준 SQL 이 대부분 지원된다.
H2 데이터 베이스 설치방법 아래 링크에서 zip 파일을 내려받아 압축을 푼다.
 링크 - http://www.h2database.com/html/main.html  압축을 푼 곳에서 bin/h2.sh 를 실행한다. 실행이 완료되면 http://localhost:8082 로 접속하면 H2에 접속할 수 있는 화면이 나온다."/>

    <meta property="og:title" content="[자바 ORM 표준 JPA 프로그래밍] 2장 JPA 시작" />
<meta property="og:description" content="김영한님의 책 자바 ORM 표준 JPA 프로그래밍 학습 내용 정리
2.2 H2 데이터베이스 설치 H2DB 는 자바 기반의 오픈소스 관계형 데이터 베이스이다. 별도의 설치과정이 필요하지 않고 용량도 1.7M 로 가볍다. SQL 문법은 다른 DBMS 와 마찬가지로 표준 SQL 이 대부분 지원된다.
H2 데이터 베이스 설치방법 아래 링크에서 zip 파일을 내려받아 압축을 푼다.
 링크 - http://www.h2database.com/html/main.html  압축을 푼 곳에서 bin/h2.sh 를 실행한다. 실행이 완료되면 http://localhost:8082 로 접속하면 H2에 접속할 수 있는 화면이 나온다." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/jpa-programming/1/page-1-2/" />
<meta property="article:published_time" content="2018-12-09T17:53:39+09:00" />
<meta property="article:modified_time" content="2018-12-09T17:53:39+09:00" />


    <style type="text/css">
        @font-face { font-family: 'Godo'; font-style: normal; font-weight: 400; src: url('//cdn.jsdelivr.net/korean-webfonts/1/corps/godo/Godo/GodoM.woff2') format('woff2'), url('//cdn.jsdelivr.net/korean-webfonts/1/corps/godo/Godo/GodoM.woff') format('woff'); } @font-face { font-family: 'Godo'; font-style: normal; font-weight: 700; src: url('//cdn.jsdelivr.net/korean-webfonts/1/corps/godo/Godo/GodoB.woff2') format('woff2'), url('//cdn.jsdelivr.net/korean-webfonts/1/corps/godo/Godo/GodoB.woff') format('woff'); } .godo * { font-family: 'Godo', sans-serif; }

        body {
            font-family: 'Nanum Gothic';
        }

        h1 {
          font-family: "Godo", "Novacento Sans Wide", "Helvetica", "Tahoma", "Geneva", "Arial", sans-serif;
          font-size: 1.6rem;
        }
        h2, h3, h4, h5, h6 {
          font-family: "Godo", "Novacento Sans Wide", "Helvetica", "Tahoma", "Geneva", "Arial", sans-serif;
          font-weight: bold;
        }

        code {
          color: #57cc8a;
           
           
           
          border-radius: .2em;
          background: rgba(255,255,255,.1);
        }
      
        pre code {
          color:#f8f8f2;
          background: #272821;
          font-size: 1em;
        }

        .chroma {
          background-color: #272821;
        }
        p img {
          margin-left: auto; margin-right: auto; display: block;
        }

        .post-content {
          font-size: .9em;
        }
        
        .post-content .image-area {
          font-size:0.8rem;
          text-align:center 
        }

        strong {
          color: #57cc8a;
        }

        hr {
          margin-block-start: 1.5em;
          margin-block-end: 1.5em;
        }

        table{
          border-collapse: collapse;
          text-align: left;
          line-height: 1.5;
          border-bottom: 1px solid #ccc;
          margin: 20px 10px;
        }
        table thead th {
            width: 150px;
            padding: 5px;
            font-weight: bold;
            vertical-align: top;
            color: #fff;
            background: #0489B1;
            margin: 20px 10px;
        }
        table tbody th {
            width: 150px;
            padding: 10px;
        }
        table td {
            width: 350px;
            padding: 10px;
            vertical-align: top;
        }
        table .even {
            background: #fdf3f5;
        }

        strong {
          color : #0489B1;
        } 

        .gist .blob-wrapper.data {
          max-height:700px;
          overflow:auto;
        }

    </style>

  </head>
  <body>
    <header class="app-header">
      <a href="/"><img class="app-header-avatar" src="/avatar.jpg" alt="riley" /></a>
      <h1>@stoptheworld99</h1>
      <p>걍 정리</p><div>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
        <a class="tag" href="/tags/elasticsearch/">elasticsearch</a><a class="tag" href="/tags/jpa/">JPA</a><a class="tag" href="/tags/h2/">H2</a><a class="tag" href="/tags/spring/">spring</a><a class="tag" href="/tags/note/">note</a></div><br/>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/stoptheworld99"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
          <a target="_blank" href="https://www.instagram.com/stoptheworld99"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-instagram">
  <title>instagram</title>
  <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.5" y2="6.5"></line>
</svg></a>
        
      </div>

    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">[자바 ORM 표준 JPA 프로그래밍] 2장 JPA 시작</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Dec 9, 2018
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          3 min read
        </div><div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="/tags/jpa/">JPA</a></div></div>
    </header>
    <div class="post-content">
      

<hr />

<p><em>김영한님의 책 자바 ORM 표준 JPA 프로그래밍 학습 내용 정리</em></p>

<h2 id="2-2-h2-데이터베이스-설치">2.2 H2 데이터베이스 설치</h2>

<p>H2DB 는 자바 기반의 오픈소스 관계형 데이터 베이스이다. 별도의 설치과정이 필요하지 않고 용량도 1.7M 로 가볍다. SQL 문법은 다른 DBMS 와 마찬가지로 표준 SQL 이 대부분 지원된다.</p>

<h3 id="h2-데이터-베이스-설치방법">H2 데이터 베이스 설치방법</h3>

<p>아래 링크에서 <code>zip</code> 파일을 내려받아 압축을 푼다.</p>

<ul>
<li><a href="http://www.h2database.com/html/main.html">링크</a> - <a href="http://www.h2database.com/html/main.html">http://www.h2database.com/html/main.html</a></li>
</ul>

<p>압축을 푼 곳에서 <code>bin/h2.sh</code> 를 실행한다. 실행이 완료되면 <a href="http://localhost:8082">http://localhost:8082</a> 로 접속하면 H2에 접속할 수 있는 화면이 나온다.</p>

<p><img src="/images/jpa/20190625215123.png?width=100px" alt="H2DB" /></p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="c1">-- 회원테이블을 생성
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">MEMBER</span> <span class="p">(</span>
    <span class="n">ID</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>   <span class="c1">-- 아이디(기본키)
</span><span class="c1"></span>    <span class="n">NAME</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>          <span class="c1">-- 이름
</span><span class="c1"></span>    <span class="n">AGE</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>       <span class="c1">-- 나이
</span><span class="c1"></span>    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID</span><span class="p">)</span>
<span class="p">)</span></code></pre></div>
<h2 id="2-3-라이브러리와-프로젝트-구조">2.3 라이브러리와 프로젝트 구조</h2>

<h3 id="jpa-구현체인-하이버네이트-사용을-위한-라이브러리">JPA 구현체인 하이버네이트 사용을 위한 라이브러리</h3>

<ul>
<li><code>hibernate-core</code> : 하이버네이트 라이브러리</li>
<li><code>hibernate-entitymanager</code> : 하이버네이트가 JPA 구현체로 동작하도록 JPA 표준을 구현한 라이브러리. 이 라이브러리를 지정하면 <strong>hibernate-core</strong> 와 <strong>hibernate-jpa-2.1-api</strong> 라이브러리도 함께 내려 받는다.</li>
<li><code>hibernate-jpa-2.1-api</code> : JPA 2.1 표준 API를 모아둔 라이브러리</li>
</ul>

<h3 id="build-gradle">build.gradle</h3>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">dependencies</span> <span class="o">{</span>

    <span class="c1">// h2 접속을 위한 라이브러리
</span><span class="c1"></span>    <span class="n">implementation</span> <span class="o">(</span><span class="s1">&#39;com.h2database:h2:1.4.199&#39;</span><span class="o">)</span>
    <span class="n">implementation</span> <span class="o">(</span><span class="s1">&#39;org.hibernate:hibernate-entitymanager:5.4.3.Final&#39;</span><span class="o">)</span>

    <span class="n">testCompile</span> <span class="nl">group:</span> <span class="s1">&#39;junit&#39;</span><span class="o">,</span> <span class="nl">name:</span> <span class="s1">&#39;junit&#39;</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">&#39;4.12&#39;</span>
<span class="o">}</span></code></pre></div>
<h2 id="2-4-객체-매핑">2.4 객체 매핑</h2>

<ul>
<li><code>@Entity</code> : 엔티티 클래스를 나타내며 이 클래스를 테이블과 매핑한다고 JPA 에 알려준다.</li>
<li><code>@Table</code>  : 엔티티 클래스에서 매핑할 테이블 정보를 명시한다. <strong>name</strong> 속성을 사용하여 매핑할 수 있으며, 이 어노테이션을 생략할 경우 클래스 이름을 테이블 이름으로 매핑한다.</li>
<li><code>@Id</code>     : 엔티티 클래스 필드의 테이블 기본키 <code>Primary Key</code> 에 매핑한다. 이렇게 <code>@Id</code> 가 사용된 필드를 식별자 필드라 한다.</li>
<li><code>@Column</code> : 필드를 컬럼에 매핑한다.</li>

<li><p>매핑정보가 없는 필드 : 매핑 어노테이션을 생략하면 필드명을 사용해서 컬럼명을 매핑한다. 만약 대소문자를 구분하는 데이터베이스를 사용하면 명시적으로 매핑해야만 한다.</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nf">jpabook</span><span class="p">.</span><span class="na">start</span><span class="p">;</span>

<span class="c1">// JPA 가 제공하는 매핑 어노테이션을 추가
</span><span class="c1"></span><span class="kn">import</span> <span class="nf">javax</span><span class="p">.</span><span class="na">persistence</span><span class="p">.</span><span class="o">*</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;MEMBER&#34;</span><span class="p">)</span>
<span class="kd">public</span> <span class="nf">class</span> <span class="n">Member</span> <span class="p">{</span>

<span class="nd">@Id</span>
<span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;ID&#34;</span><span class="p">)</span>
<span class="kd">private</span> <span class="nf">String</span> <span class="n">id</span><span class="p">;</span>          <span class="c1">// 아이디
</span><span class="c1"></span>
<span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;NAME&#34;</span><span class="p">)</span>
<span class="kd">private</span> <span class="nf">String</span> <span class="n">username</span><span class="p">;</span>    <span class="c1">// 이름
</span><span class="c1"></span>
<span class="kd">private</span> <span class="nf">Integer</span> <span class="n">age</span><span class="p">;</span>        <span class="c1">// 나이
</span><span class="c1"></span>
<span class="c1">// Getter, Setter
</span><span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span></code></pre></div></li>
</ul>

<h2 id="2-5-persistence-xml-설정">2.5 persistence.xml 설정</h2>

<ul>
<li>JPA 는 <code>persistence.xml</code> 을 사용해서 필요한 설정정보를 관리한다. 이 설정 파일이 <code>META-INF/persistence.xml</code> 클래스 패스 경로에 있으면 별도의 설정없이 JPA 가 인식할 수 있다.</li>
</ul>

<script src="https://gist.github.com/stoptheworld99/f9b612ee9c0dc83a350da1aea9e8c600.js"></script>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;persistence-unit</span> <span class="na">name=</span><span class="s">&#34;jpabook&#34;</span><span class="nt">&gt;</span></code></pre></div>
<p>JPA 설정은 영속성 유닛 <code>persistence-unit</code> 이라는 것부터 시작하는데 일반적으로 연결할 데이터베이스당 하나의 영속성 유닛을 등록한다.</p>

<h3 id="데이터베이스-방언">데이터베이스 방언</h3>

<ul>
<li>JPA 는 특정 데이터베이스에 종속적이지 않은 기술이다.</li>
<li>각 데이터베이스는 <code>데이터 타입</code>, <code>제공 함수명</code>, <code>페이징처리</code> 등 제공하는 SQL 문법과 함수가 조금씩 다르다.</li>
<li>SQL 표준을 지키지 않거나 특정 데이터베이스만의 고유한 기능을 JPA 에서는 방언<code>Dialect</code> 라 한다.</li>
<li>하이버에니트를 포함한 대부분의 JPA 구현체들은 다양한 데이터베이스 방언 클래스를 제공한다.</li>
</ul>

<h3 id="각-데이터베이스별-방언클래스">각 데이터베이스별 방언클래스</h3>

<ul>
<li><a href="https://docs.jboss.org/hibernate/orm/4.3/manual/en-US/html_single/#configuration-optional-dialects">https://docs.jboss.org/hibernate/orm/4.3/manual/en-US/html_single/#configuration-optional-dialects</a></li>
</ul>

<h2 id="2-6-애플리케이션-개발">2.6 애플리케이션 개발</h2>

<script src="https://gist.github.com/stoptheworld99/7ea6ea35fee74c3deed010a4ae191401.js"></script>

<h3 id="2-6-1-엔티티-매니저-설정">2.6.1 엔티티 매니저 설정</h3>

<h4 id="엔티티-매니저-팩토리-생성">엔티티 매니저 팩토리 생성</h4>

<ul>
<li>JPA 를 시작하기 위해서는 <code>persistence.xml</code> 설정 정보를 사용하여 엔티티 매니저 팩토리를 생성해야한다. 엔티티 매니저 팩토리는 <code>persistence.xml</code>설정 정보를 읽어 JPA 동작시키기 위한 기반 객체를 만들고 JPA 구현체에 따라서 커넥션 풀도 생성한다.</li>
<li>엔티티 매니저 팩토리는 생성 비용이 매우크므로 <strong>애플리케이션 전체에서 딱 한 번만 생성하고 공유해서 사용해야 한다.</strong></li>
</ul>

<h4 id="엔티티-매니저-생성">엔티티 매니저 생성</h4>

<ul>
<li>JPA 대부분의 기능을 엔티티 매니저에서 제공한다.</li>
<li><strong>엔티티 매니저를 사용해서 엔티티를 데이터베이스에 등록/수정/삭제/조회 할 수 있다.</strong></li>
<li><strong>엔티티 매니저는 데이터베이스 커넥션과 밀접한 관련이 있으므로 스레드 간 공유하거나 재사용하면 안된다.</strong></li>
</ul>

<h4 id="종료">종료</h4>

<ul>
<li>사용이 끝난 엔티티 매니저와 엔티티 매니저 팩토리는 종료해야 한다.</li>
</ul>

<h3 id="2-6-2-트랜잭션-관리">2.6.2 트랜잭션 관리</h3>

<ul>
<li>JPA 를 사용하면 항상 트랜잭션 안에서 데이터를 변경해야 한다.</li>
<li>트랜잭션을 시작하려면 엔티티 매니저 에서 트랜잭션 API 를 받아와야 한다.</li>

<li><p>트랜잭션 API 를 사용하여 비즈니스 로직이 정상 동작하면 트랜잭션을 커밋 <code>commit</code> 하고 예외가 발생하면 <code>rollback</code> 한다.</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 트랜잭션 기능 획득
</span><span class="c1"></span><span class="n">EntityTransaction</span> <span class="nf">tx</span> <span class="o">=</span> <span class="n">em</span><span class="p">.</span><span class="na">getTransaction</span><span class="p">();</span></code></pre></div></li>
</ul>

<h3 id="2-6-4-jpql">2.6.4 JPQL</h3>

<ul>
<li>JPA 는 SQL 을 추상화한 JSQP 이라는 객체 지향 쿼리 언어를 제공한다.</li>
<li>JPQL 은 SQL 과 문법이 거의 유사하다.</li>
</ul>

<h4 id="차이점">차이점</h4>

<ul>
<li>JPQL 은 <strong>엔티티 객체</strong> 를 대상으로 쿼리한다.</li>

<li><p>SQL 은 <strong>데이터베이스 테이블</strong> 을 대상으로 쿼리한다.</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 목록 조회
</span><span class="c1"></span><span class="n">TypedQuery</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="nf">query</span> <span class="o">=</span> <span class="n">em</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">&#34; SELECT m FROM Member m &#34;</span><span class="p">,</span> <span class="n">Member</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="nf">members</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="na">getResultList</span><span class="p">();</span></code></pre></div></li>
</ul>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
